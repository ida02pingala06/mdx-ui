---
title: Next.js + Contentlayer
description: Integrate MDX UI with Next.js using Contentlayer
published: true
---

## Overview

[Contentlayer](https://contentlayer.dev/) is a content SDK that validates and transforms your content into type-safe JSON data. It provides excellent TypeScript support and caching.

**Best for:** Type-safe content, large documentation sites, content validation

## Installation

### 1. Install Dependencies

```bash
npm install contentlayer2 next-contentlayer2
```

### 2. Initialize MDX UI

```bash
npx @suryaravikumar/mdx-ui init
```

### 3. Install Components

```bash
npx @suryaravikumar/mdx-ui add headings paragraph callout steps
```

## Setup

### 1. Configure Contentlayer

Create `contentlayer.config.ts` in your project root:

```ts
import { defineDocumentType, makeSource } from 'contentlayer2/source-files'
import rehypeSlug from 'rehype-slug'
import rehypeAutolinkHeadings from 'rehype-autolink-headings'
import remarkGfm from 'remark-gfm'

export const Post = defineDocumentType(() => ({
  name: 'Post',
  filePathPattern: `blog/**/*.mdx`,
  contentType: 'mdx',
  fields: {
    title: {
      type: 'string',
      required: true,
    },
    date: {
      type: 'date',
      required: true,
    },
    description: {
      type: 'string',
    },
    published: {
      type: 'boolean',
      default: true,
    },
  },
  computedFields: {
    slug: {
      type: 'string',
      resolve: (post) => post._raw.flattenedPath.replace('blog/', ''),
    },
  },
}))

export default makeSource({
  contentDirPath: 'content',
  documentTypes: [Post],
  mdx: {
    remarkPlugins: [remarkGfm],
    rehypePlugins: [
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'wrap' }],
    ],
  },
})
```

### 2. Update Next.js Config

Modify `next.config.mjs`:

```js
import { withContentlayer } from 'next-contentlayer2'

/** @type {import('next').NextConfig} */
const nextConfig = {
  // Your Next.js config
}

export default withContentlayer(nextConfig)
```

### 3. Update TypeScript Config

Add to `tsconfig.json`:

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"],
      "contentlayer/generated": ["./.contentlayer/generated"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".contentlayer/generated"
  ]
}
```

### 4. Create Component Mappings

Create `components/mdx-components.tsx`:

```tsx
import { H1, H2, H3, H4, H5, H6 } from "@/components/mdx-ui/headings"
import { P } from "@/components/mdx-ui/paragraph"
import { Callout } from "@/components/mdx-ui/callout"
import { Steps } from "@/components/mdx-ui/steps"

export const mdxComponents = {
  h1: H1,
  h2: H2,
  h3: H3,
  h4: H4,
  h5: H5,
  h6: H6,
  p: P,
  Callout,
  Steps,
}
```

### 5. Create Content

Create `content/blog/first-post.mdx`:

```mdx
---
title: My First Post
date: 2024-01-01
description: Getting started with MDX UI and Contentlayer
---

# Welcome

This is my first blog post using **MDX UI** with Contentlayer.

<Callout variant="info" title="Type Safety">
  Contentlayer provides full TypeScript support for your content!
</Callout>

<Steps>

### Step 1: Install Dependencies

Install all required packages.

### Step 2: Configure Contentlayer

Set up your content schema.

### Step 3: Start Writing

Create your first MDX file!

</Steps>
```

### 6. Create Blog Post Page

Create `app/blog/[slug]/page.tsx`:

```tsx
import { notFound } from 'next/navigation'
import { allPosts } from 'contentlayer/generated'
import { useMDXComponent } from 'next-contentlayer2/hooks'
import { mdxComponents } from '@/components/mdx-components'

export async function generateStaticParams() {
  return allPosts.map((post) => ({
    slug: post.slug,
  }))
}

export async function generateMetadata({ params }: { params: { slug: string } }) {
  const post = allPosts.find((post) => post.slug === params.slug)

  if (!post) return {}

  return {
    title: post.title,
    description: post.description,
  }
}

export default function BlogPost({ params }: { params: { slug: string } }) {
  const post = allPosts.find((post) => post.slug === params.slug)

  if (!post) notFound()

  const MDXContent = useMDXComponent(post.body.code)

  return (
    <article className="prose dark:prose-invert max-w-4xl mx-auto px-4 py-8">
      <header className="mb-8">
        <h1 className="mb-2">{post.title}</h1>
        <time className="text-muted-foreground">
          {new Date(post.date).toLocaleDateString()}
        </time>
        {post.description && (
          <p className="text-lg text-muted-foreground mt-2">
            {post.description}
          </p>
        )}
      </header>

      <MDXContent components={mdxComponents} />
    </article>
  )
}
```

### 7. Create Blog List Page

Create `app/blog/page.tsx`:

```tsx
import Link from 'next/link'
import { allPosts } from 'contentlayer/generated'
import { compareDesc } from 'date-fns'

export default function BlogPage() {
  const posts = allPosts
    .filter((post) => post.published)
    .sort((a, b) => compareDesc(new Date(a.date), new Date(b.date)))

  return (
    <div className="max-w-4xl mx-auto px-4 py-8">
      <h1 className="text-4xl font-bold mb-8">Blog</h1>

      <div className="space-y-6">
        {posts.map((post) => (
          <article key={post.slug} className="border-b pb-6">
            <Link href={`/blog/${post.slug}`}>
              <h2 className="text-2xl font-semibold hover:text-blue-600">
                {post.title}
              </h2>
            </Link>
            <time className="text-sm text-muted-foreground">
              {new Date(post.date).toLocaleDateString()}
            </time>
            {post.description && (
              <p className="mt-2 text-muted-foreground">
                {post.description}
              </p>
            )}
          </article>
        ))}
      </div>
    </div>
  )
}
```

## Advanced Features

### Multiple Document Types

Define different content types:

```ts
export const Doc = defineDocumentType(() => ({
  name: 'Doc',
  filePathPattern: `docs/**/*.mdx`,
  contentType: 'mdx',
  fields: {
    title: { type: 'string', required: true },
    category: { type: 'string', required: true },
  },
}))

export const Post = defineDocumentType(() => ({
  name: 'Post',
  filePathPattern: `blog/**/*.mdx`,
  contentType: 'mdx',
  fields: {
    title: { type: 'string', required: true },
    date: { type: 'date', required: true },
  },
}))

export default makeSource({
  contentDirPath: 'content',
  documentTypes: [Doc, Post],
})
```

### Table of Contents

Extract headings for navigation:

```ts
export const Post = defineDocumentType(() => ({
  name: 'Post',
  filePathPattern: `blog/**/*.mdx`,
  contentType: 'mdx',
  fields: {
    // ... your fields
  },
  computedFields: {
    slug: {
      type: 'string',
      resolve: (post) => post._raw.flattenedPath.replace('blog/', ''),
    },
    headings: {
      type: 'json',
      resolve: async (post) => {
        const headings: { level: number; text: string; slug: string }[] = []
        const regex = /^(#{2,3})\s+(.+)$/gm
        let match

        while ((match = regex.exec(post.body.raw)) !== null) {
          const level = match[1].length
          const text = match[2]
          const slug = text.toLowerCase().replace(/\s+/g, '-')
          headings.push({ level, text, slug })
        }

        return headings
      },
    },
  },
}))
```

Then use it in your component:

```tsx
export default function BlogPost({ params }: { params: { slug: string } }) {
  const post = allPosts.find((post) => post.slug === params.slug)

  if (!post) notFound()

  const MDXContent = useMDXComponent(post.body.code)

  return (
    <div className="grid grid-cols-[1fr_250px] gap-8">
      <article>
        <MDXContent components={mdxComponents} />
      </article>

      <aside>
        <h3 className="font-semibold mb-4">On this page</h3>
        <nav>
          {post.headings.map((heading) => (
            <a
              key={heading.slug}
              href={`#${heading.slug}`}
              className={`block py-1 ${
                heading.level === 3 ? 'ml-4' : ''
              }`}
            >
              {heading.text}
            </a>
          ))}
        </nav>
      </aside>
    </div>
  )
}
```

## Troubleshooting

### Build errors

Run Contentlayer to generate types:

```bash
npx contentlayer2 build
```

### Type errors after adding new fields

Restart your development server after changing `contentlayer.config.ts`.

### Hot reload not working

Make sure `withContentlayer` is wrapping your Next.js config.

## Next Steps

- [Component Mappings](/docs/integration/component-mappings)
- [Browse Components](/components)
- [Contentlayer Documentation](https://contentlayer.dev/)
